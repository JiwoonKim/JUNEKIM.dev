{"componentChunkName":"component---src-components-templates-blog-post-js","path":"/CS50/web50/lecture_7/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<p>Harvard's Web Programming with Python and Javascript lecture 7 정리</p>\n</blockquote>\n<h3>Django</h3>\n<p>a heavier web framework w/ more built-in features to develop more sophisticated and complicated web applications easily</p>\n<h3>Using Django</h3>\n<ul>\n<li>\n<p><strong>projects</strong>: Django divides all of its web application into multiple projects, composed of different parts</p>\n<ul>\n<li><strong>create new project</strong>: <code>django-admin startproject {project_name}</code></li>\n</ul>\n</li>\n<li>\n<p><strong>appications</strong>: project consists of one or more Django applications, which serves a particular purpose</p>\n<ul>\n<li><strong>create new app</strong>: <code>python manage.py startapp {app_name}</code> <strong>inside the project directory</strong></li>\n</ul>\n</li>\n<li><strong>run server</strong>: <code>python manage.py runserver</code> inside project directory</li>\n</ul>\n<h4>Project</h4>\n<p>creates a directory {project_name} w/ one python file and one directory</p>\n<ul>\n<li><code>manage.py</code>: python script to use to perform useful operations on the app</li>\n<li>\n<p><code>{project_name}/</code> <strong>directory</strong></p>\n<ul>\n<li><code>__init__.py</code>: defines {project_name/} directory as a package (= collection of python files)</li>\n<li><code>settings.py</code>: defines settings for the app</li>\n<li><code>urls.py</code>: associates urls to functions (for the entire project)</li>\n<li><code>wsgi.py</code>: file that helps to deploy an app to a web server</li>\n</ul>\n</li>\n</ul>\n<h4>App (inside project)</h4>\n<p>creates a {app_name} directory (w/ multiple python files and one migrations folder) inside the project directory</p>\n<ul>\n<li><code>__init__.py</code>: defines {app_name/} directory as a package (= collection of multiple python files)</li>\n<li><code>admin.py</code>: add models in app to be accessed/manipulated from admin app</li>\n<li><code>apps.py</code>: defines configuration of app</li>\n<li><code>models.py</code>: where classes for specific data types are defined in order to be stored in database</li>\n<li><code>tests.py</code>: defines tests for app (check lecture 8)</li>\n<li><code>urls.py</code>: associates urls to functions (for this specific app) -> need to manually create file</li>\n<li><code>views.py</code>: where functions are defined for each routes</li>\n<li><code>migrations/</code> folder: automatically detect changes in models and generate sql codes to make changes to the database (instead of manually coding sql commands)</li>\n</ul>\n<h3>Configure Views</h3>\n<p>airlines application example (airline project - flights app)</p>\n<ul>\n<li>\n<p><code>views.py</code>: where functions are defined for each routes</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.http </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> HttpResponse</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create views: always include request as parameter</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">index</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">HttpResponse</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;flights!&quot;</span><span class=\"mtk1\">)</span></span></code></pre>\n</li>\n<li>\n<p><code>flights/urls.py</code>: associates urls to functions (for this specific app) -> need to manually create file</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\"># import path variable</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.urls </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> path</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># import views function from current directory</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> . </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> views</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># associate urls to certain functions for this particular app</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpattern </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># / -&gt; views.index()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&quot;</span><span class=\"mtk1\">, view.index)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n<li>\n<p><code>urls.py</code>: associates urls to functions (<strong>for the entire app</strong>; project app only looks into the project's urls.py not into the app's urls.py -> need to link to app's urls.py)</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.contrib </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> admin</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.urls </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> include, path</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># associate urls to certain apps&#39; urls for the entire project</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpatterns </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&#39;&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">include</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&#39;flights.urls&#39;</span><span class=\"mtk1\">)),</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&#39;admin/&#39;</span><span class=\"mtk1\">, admin.site.urls),</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n</ul>\n<h4>Routes w/ Parameters</h4>\n<p>add flight view page </p>\n<ul>\n<li>\n<p><code>views.py</code>: add function to use data in parameter</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># define function w/ parameter as argument</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">flight</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">, </span><span class=\"mtk3\">flight_id</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># retrieve data from database using parameter</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">try</span><span class=\"mtk1\">:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        flight </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> Flight.objects.</span><span class=\"mtk7\">get</span><span class=\"mtk1\">(</span><span class=\"mtk3\">pk</span><span class=\"mtk5\">=</span><span class=\"mtk1\">flight_id)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">except</span><span class=\"mtk1\"> Flight.DoesNotExist:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">raise</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Http404</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;Flight does not exist&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># return template w/ data</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    context </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;flight&quot;</span><span class=\"mtk1\">: flight,</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    }</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;flights/flight.html&quot;</span><span class=\"mtk1\">, context)</span></span></code></pre>\n</li>\n<li>\n<p><code>flights/urls.py</code>: add view function to app's url</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpatterns </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&lt;int:flight_id&gt;, views.flight)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n</ul>\n<h4>Form</h4>\n<p>add registration page for flights</p>\n<ul>\n<li>\n<p>create form to flight page (w/ dropdown of passengers)</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- add form inside flight.html --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">h2</span><span class=\"mtk1\">&gt;Add a passenger&lt;/</span><span class=\"mtk8\">h2</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">form</span><span class=\"mtk1\"> </span><span class=\"mtk7\">action</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;{% url &#39;book&#39; flight.id %}&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">method</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;post&quot;</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    {% csrf_token %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk8\">select</span><span class=\"mtk1\"> </span><span class=\"mtk7\">name</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;passenger&quot;</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        {% for passenger in non_passengers %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        &lt;</span><span class=\"mtk8\">option</span><span class=\"mtk1\"> </span><span class=\"mtk7\">value</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;{{ passenger.id }}&quot;</span><span class=\"mtk1\">&gt;{{ passenger }}&lt;/</span><span class=\"mtk8\">option</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        {% endfor %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk8\">select</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk8\">input</span><span class=\"mtk1\"> </span><span class=\"mtk7\">type</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;submit&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">value</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;Book Flight&quot;</span><span class=\"mtk1\"> /&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk8\">form</span><span class=\"mtk1\">&gt;</span></span></code></pre>\n</li>\n<li>\n<p><code>views.py</code>: add function for users to register to flights</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\"># add fields to context in flight function</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    context </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;passengers&quot;</span><span class=\"mtk1\">: flight.passengers.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">(),</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;non-passengers&quot;</span><span class=\"mtk1\">: Passenger.objects.</span><span class=\"mtk7\">exclude</span><span class=\"mtk1\">(</span><span class=\"mtk3\">flights</span><span class=\"mtk5\">=</span><span class=\"mtk1\">flight).</span><span class=\"mtk7\">all</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    }</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># define function to book flight</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">book</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">, </span><span class=\"mtk3\">flight_id</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># retrieve passenger and flights</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">try</span><span class=\"mtk1\">:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        passenger_id </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> int(request.</span><span class=\"mtk6\">POST</span><span class=\"mtk1\">[</span><span class=\"mtk12\">&quot;passenger&quot;</span><span class=\"mtk1\">])</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        passenger </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> Passenger.objects.</span><span class=\"mtk7\">get</span><span class=\"mtk1\">(</span><span class=\"mtk3\">pk</span><span class=\"mtk5\">=</span><span class=\"mtk1\">passenger_id)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        flight </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> Flight.objects.</span><span class=\"mtk7\">get</span><span class=\"mtk1\">(</span><span class=\"mtk3\">pk</span><span class=\"mtk5\">=</span><span class=\"mtk1\">flight_id)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># render error cases</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">except</span><span class=\"mtk1\"> </span><span class=\"mtk6\">KeyError</span><span class=\"mtk1\">:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;flights/error.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;No selection made&quot;</span><span class=\"mtk1\">})</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">except</span><span class=\"mtk1\"> Passenger.DoesNotExist:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;flights/error.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;No passenger&quot;</span><span class=\"mtk1\">})</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">except</span><span class=\"mtk1\"> Flight.DoesNotExist:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;flights/error.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;No flight&quot;</span><span class=\"mtk1\">})</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># add flight to passenger&#39;s flights information</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    passenger.flights.</span><span class=\"mtk7\">add</span><span class=\"mtk1\">(flight)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># redirect to flight page</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">HttpResponseRedirect</span><span class=\"mtk1\">(</span><span class=\"mtk7\">reverse</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;flight&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">args</span><span class=\"mtk1\">(flight_id, )))</span></span></code></pre>\n</li>\n<li>\n<p><code>flights/urls.py</code>: add book function to app's url</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpatterns </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&lt;int:flight_id&gt;/book, views.book, name=&quot;</span><span class=\"mtk1\">book</span><span class=\"mtk12\">&quot;)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n<li>\n<p><strong>CSRF (Cross-site Request Forgery)</strong>: potential security vulnerability in forms whereby someone could forge where the form is coming from -> Django built-in to protect from these attacks</p>\n<ul>\n<li>add <code>{% csrf-token %}</code> within form tag</li>\n</ul>\n</li>\n</ul>\n<h4>Link between URLS</h4>\n<ul>\n<li>\n<p><strong>name urls</strong> in <code>flights/urls.py</code> so that can refer to route using name</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpatterns </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&quot;</span><span class=\"mtk1\">, views.index, </span><span class=\"mtk3\">name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;index&quot;</span><span class=\"mtk1\">), </span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&lt;int:flight_id&gt;&quot;</span><span class=\"mtk1\">, views.flight, </span><span class=\"mtk3\">name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;flight&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n<li>\n<p>use urls in html: <code>{% url 'route_name' %}</code> in href</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- flight.html: add link to route to index --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">a</span><span class=\"mtk1\"> </span><span class=\"mtk7\">href</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;{% url &#39;index&#39; %}&quot;</span><span class=\"mtk1\">&gt;Back to index page&lt;/</span><span class=\"mtk8\">a</span><span class=\"mtk1\">&gt;</span></span></code></pre>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- index.html: add link to route to flight/{flight_id} --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">a</span><span class=\"mtk1\"> </span><span class=\"mtk7\">href</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;{% url &#39;flight&#39; flight.id %}&quot;</span><span class=\"mtk1\">&gt;{{ flight}} &lt;/</span><span class=\"mtk8\">a</span><span class=\"mtk1\">&gt;</span></span></code></pre>\n</li>\n</ul>\n<h3>Templates</h3>\n<h4>Rendering Templates</h4>\n<ul>\n<li>\n<p><code>views.py</code>: define function to return template</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.http </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> HttpResponse</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.shortcuts </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> render</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> .models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> Flight</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># define function for view</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">index</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># define context to include data from database</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    context </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;flights&quot;</span><span class=\"mtk1\">: Flight.objects.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    }</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># return template and pass context</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;flights/index.html&quot;</span><span class=\"mtk1\">, context)</span></span></code></pre>\n</li>\n<li>\n<p><strong>create <code>templates</code> folder</strong>:</p>\n<ul>\n<li>create <code>flights</code> <strong>folder where template file will be stored</strong> (define as <strong>namespace templates</strong>)</li>\n</ul>\n</li>\n<li>\n<p><strong>create template</strong></p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- airline/flights/templates/flights/index.html --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">h1</span><span class=\"mtk1\">&gt; Flights &lt;/</span><span class=\"mtk8\">h1</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">ul</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    {% for flight in flights %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk8\">li</span><span class=\"mtk1\">&gt; {{ flight }} &lt;/</span><span class=\"mtk8\">li</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    {% endfor %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk8\">ul</span><span class=\"mtk1\">&gt;</span></span></code></pre>\n</li>\n</ul>\n<h4>Template Inheritance</h4>\n<ul>\n<li>\n<p>create generic template</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- base.html --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">head</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk8\">title</span><span class=\"mtk1\">&gt; {% block title %}{% endblock %} &lt;/</span><span class=\"mtk8\">title</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk8\">head</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">body</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    {% block body %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    {% endblock %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk8\">body</span><span class=\"mtk1\">&gt;</span></span></code></pre>\n</li>\n<li>\n<p>extend generic template </p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">&lt;!-- index.html --&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">{% extends &quot;flights/base.html&quot; %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">{% block title %} Flights {% endblock %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">{% body block %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk8\">h1</span><span class=\"mtk1\">&gt;Flights&lt;/</span><span class=\"mtk8\">h1</span><span class=\"mtk1\">&gt;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">{% endblock %}</span></span></code></pre>\n</li>\n</ul>\n<h3>Configure Models (databases)</h3>\n<p>airlines application example (airline project - flights app)</p>\n<ol>\n<li>define models</li>\n<li>include models in project's config</li>\n<li>make migrations to database</li>\n</ol>\n<h4>1. Define models</h4>\n<ul>\n<li><code>models.py</code>: where classes for specific data types are defined in order to be stored in database</li>\n<li>\n<p><strong>create a separate Airport model and reference it in Flights model via ID</strong></p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.db </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> models</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># define airport model</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Airport</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">models</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">Model</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    code </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">CharField</span><span class=\"mtk1\">(</span><span class=\"mtk3\">max_length</span><span class=\"mtk5\">=</span><span class=\"mtk6\">3</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    city </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">CharField</span><span class=\"mtk1\">(</span><span class=\"mtk3\">max_length</span><span class=\"mtk5\">=</span><span class=\"mtk6\">64</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># define print function of class</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">__str__</span><span class=\"mtk1\">(</span><span class=\"mtk3\">self</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk9\">f</span><span class=\"mtk12\">&quot;</span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.city</span><span class=\"mtk5\">}</span><span class=\"mtk12\"> (</span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.code</span><span class=\"mtk5\">}</span><span class=\"mtk12\">)&quot;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># define flight model (using references from airport model)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Flight</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">models</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">Model</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    origin </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">ForeignKey</span><span class=\"mtk1\">(Airport, </span><span class=\"mtk3\">on_delete</span><span class=\"mtk5\">=</span><span class=\"mtk1\">models.</span><span class=\"mtk6\">CASCADE</span><span class=\"mtk1\">, </span><span class=\"mtk3\">related_name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;departures&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    destination </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">ForeignKey</span><span class=\"mtk1\">(Airport, </span><span class=\"mtk3\">on_delete</span><span class=\"mtk5\">=</span><span class=\"mtk1\">models.</span><span class=\"mtk6\">CASCADE</span><span class=\"mtk1\">, </span><span class=\"mtk3\">related_name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;arrivals&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    duration </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">IntegerField</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># define print function of class</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">__str__</span><span class=\"mtk1\">(</span><span class=\"mtk3\">self</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk9\">f</span><span class=\"mtk12\">&quot;</span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.id</span><span class=\"mtk5\">}</span><span class=\"mtk12\"> - </span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.origin</span><span class=\"mtk5\">}</span><span class=\"mtk12\"> to </span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.destination</span><span class=\"mtk5\">}</span><span class=\"mtk12\">&quot;</span></span></code></pre>\n</li>\n<li>reference to another class using <code>ForeignKey()</code></li>\n<li>specify <code>on_delete=models.CASCADE</code> to delete all flights w/ that airport when that airport instance is deleted from database</li>\n<li>specify <code>related_name=\"key\"</code> to use key to access only those specific cases (flights w/ key)</li>\n</ul>\n<h4>2. Include Model in Project's Config</h4>\n<ul>\n<li>\n<p><code>{airline_project}/settings.py</code>: let the app know the models (-> include app's class in INSTALLED_APPS)</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk6\">INSTALLED_APPS</span><span class=\"mtk1\"> </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># include model (flights/apps.py 내의 FlightsConfig class)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk12\">&#39;flights.apps.flightsConfig&#39;</span><span class=\"mtk1\">,</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n</ul>\n<h4>3. Make Migrations</h4>\n<ul>\n<li>\n<p><code>migrations/</code> folder: automatically detect changes in models and generate sql codes to make changes to the database (instead of manually coding sql commands)</p>\n<ul>\n<li><strong>create migrations</strong>: <code>python manage.py makemigrations</code></li>\n<li>\n<p><strong>apply migrations</strong>: <code>python manage.py migrate</code></p>\n<ul>\n<li>cf) view the actual sql command: <code>python manage.py sqlmigrate {app} {migration #}</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>cf) database defined in <code>{project}/settings.py</code> 내의 DATABASES 부분</li>\n</ul>\n<h4>cf) Django shell</h4>\n<ul>\n<li>\n<p>use: <code>python manage.py shell</code></p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">## implement code line-by-line in shell terminal</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># import airport and flight class</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> flights.models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> Airport, Flight</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create instance for airports (insert data)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">jfk </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Airport</span><span class=\"mtk1\">(</span><span class=\"mtk3\">code</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;JFK&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk3\">city</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;New York City&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">lhr </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Airport</span><span class=\"mtk1\">(</span><span class=\"mtk3\">code</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;LHR&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk3\">city</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;London&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># save the change to database</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">jfk.</span><span class=\"mtk7\">save</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">lhr.</span><span class=\"mtk7\">save</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create instance for flight (insert data)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Flight</span><span class=\"mtk1\">(</span><span class=\"mtk3\">origin</span><span class=\"mtk5\">=</span><span class=\"mtk1\">jfk, </span><span class=\"mtk3\">destination</span><span class=\"mtk5\">=</span><span class=\"mtk1\">lhr, </span><span class=\"mtk3\">duration</span><span class=\"mtk5\">=</span><span class=\"mtk6\">415</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f.</span><span class=\"mtk7\">save</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># query for data</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">Flight.objects.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">jfk.departures.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">() </span><span class=\"mtk4\"># returns flights which origin=jfk</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># access instance</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f.origin.code</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># delete instance from database</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f.</span><span class=\"mtk7\">delete</span><span class=\"mtk1\">()</span></span></code></pre>\n</li>\n</ul>\n<h4>Model Relationships</h4>\n<p><strong>many-to-many relationships</strong></p>\n<ul>\n<li>create an in-between table (to map between two relationships to allow many-to-many relationships)</li>\n<li>\n<p><code>models.py</code>: define class using <code>ManyToManyField</code></p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Passenger</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">models</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">Model</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    first </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">CharField</span><span class=\"mtk1\">(</span><span class=\"mtk3\">max_length</span><span class=\"mtk5\">=</span><span class=\"mtk6\">64</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    second </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">CharField</span><span class=\"mtk1\">(</span><span class=\"mtk3\">max_length</span><span class=\"mtk5\">=</span><span class=\"mtk6\">64</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    flights </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> models.</span><span class=\"mtk7\">ManyToManyField</span><span class=\"mtk1\">(Flight, </span><span class=\"mtk3\">blank</span><span class=\"mtk5\">=True</span><span class=\"mtk1\">, </span><span class=\"mtk3\">related_name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;passengers&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">__str__</span><span class=\"mtk1\">(</span><span class=\"mtk3\">self</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk9\">f</span><span class=\"mtk12\">&quot;</span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.first</span><span class=\"mtk5\">}</span><span class=\"mtk12\"> </span><span class=\"mtk5\">{</span><span class=\"mtk11\">self</span><span class=\"mtk1\">.last</span><span class=\"mtk5\">}</span><span class=\"mtk12\">&quot;</span></span></code></pre>\n<ul>\n<li>Django automatically creates in-between table when <code>ManyToManyField</code> is used</li>\n</ul>\n</li>\n<li>\n<p>shell to interact w/ that model</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">## implement code line-by-line in shell terminal</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> flights.models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> Flight, Passenger</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create passenger instance and save</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">p </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">Passenger</span><span class=\"mtk1\">(</span><span class=\"mtk3\">first</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;Alice&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk3\">last</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;Adams&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">p.</span><span class=\"mtk7\">save</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># add flight to passenger&#39;s field</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> Flight.objects.</span><span class=\"mtk7\">get</span><span class=\"mtk1\">(</span><span class=\"mtk3\">pk</span><span class=\"mtk5\">=</span><span class=\"mtk6\">1</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">p.flights.</span><span class=\"mtk7\">add</span><span class=\"mtk1\">(f)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># query for passenger&#39;s flights</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">p.flights.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># query for flight&#39;s passengers</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">f.passengers.</span><span class=\"mtk7\">all</span><span class=\"mtk1\">()</span></span></code></pre>\n</li>\n</ul>\n<h3>Admin</h3>\n<p><strong>built-in app that makes it easy to manipulate data</strong> for the web page</p>\n<ul>\n<li>\n<p><code>admin.py</code>: add models in app to be accessed/manipulated from admin app</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.contrib </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> admin</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> .models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> Airport, Flight</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># register models to use in admin app</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Airport)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Flight)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Passenger)</span></span></code></pre>\n</li>\n<li>\n<p><strong>register and login to admin</strong>:</p>\n<ul>\n<li>register: <code>python manage.py createsuperuser</code></li>\n<li>login: via admin site</li>\n</ul>\n</li>\n<li>runserver and go to <code>/admin</code> route to access user interface</li>\n</ul>\n<h4>Extend Admin Interface</h4>\n<p>extend admin interface to allow for custom behavior</p>\n<ul>\n<li>\n<p><code>flights/admin.py</code>: add defining custom models</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.contrib </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> admin</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> .models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> Airport, Flight, Passenger</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># customize admin interface</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PassengerInline</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">admin</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">StackedInline</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># allow flight -&gt; passenger modification at admin</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    model </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> Passenger.flights.through</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    extra </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">1</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\">## extend admin models</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">FlightAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">admin</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">ModelAdmin</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># add that inline function for admin</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    inlines </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [PassengerInline]</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># use special admin class</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">class</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PassengerAdmin</span><span class=\"mtk1\">(</span><span class=\"mtk7 mtku\">admin</span><span class=\"mtk1\">.</span><span class=\"mtk7 mtku\">ModelAdmin</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># add easy way to move flights back and forth for a passenger</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    fliter_horizontal </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">&quot;flights&quot;</span><span class=\"mtk1\">,)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># register models</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Airport)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Flight, FlightAdmin)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">admin.site.</span><span class=\"mtk7\">register</span><span class=\"mtk1\">(Passenger, PassengerAdmin)</span></span></code></pre>\n</li>\n</ul>\n<h3>Login and Authentication</h3>\n<p>built-in app for authentication for users</p>\n<ul>\n<li>create users app</li>\n<li>\n<p><code>users/urls.py</code>: </p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk1\">urlpatterns </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> [</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk5\">...</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;&quot;</span><span class=\"mtk1\">, views.index, </span><span class=\"mtk3\">name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;index&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;login&quot;</span><span class=\"mtk1\">, views.login_view, </span><span class=\"mtk3\">name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;login&quot;</span><span class=\"mtk1\">),</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">path</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;logout&quot;</span><span class=\"mtk1\">, views.logout_view, </span><span class=\"mtk3\">name</span><span class=\"mtk5\">=</span><span class=\"mtk12\">&quot;logout&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">]</span></span></code></pre>\n</li>\n<li>\n<p><code>users/views.py</code>:</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\"># Django&#39;s built-in authentication library </span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django contrib.auth </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> authenticate, login, logou</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># other Django libraries</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.http </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> HttpResponse, HttpResponseRedirect</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.shortcuts </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> render</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.urls </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> reverse</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create index view function</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">index</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># if request is not authenticated, return login page</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">if</span><span class=\"mtk1\"> </span><span class=\"mtk5\">not</span><span class=\"mtk1\"> request.user.is_authenticated:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;users/login.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk5\">None</span><span class=\"mtk1\">})</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># if authenticated, return user page</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    context </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> {</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;user&quot;</span><span class=\"mtk1\">: request.user</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    }</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;users/user.html&quot;</span><span class=\"mtk1\">, context)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create login view function</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">login_view</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    username </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> request.</span><span class=\"mtk6\">POST</span><span class=\"mtk1\">[</span><span class=\"mtk12\">&quot;username&quot;</span><span class=\"mtk1\">]</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    password </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> request.</span><span class=\"mtk6\">POST</span><span class=\"mtk1\">[</span><span class=\"mtk12\">&quot;password&quot;</span><span class=\"mtk1\">]</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    user </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">authenticate</span><span class=\"mtk1\">(request, </span><span class=\"mtk3\">username</span><span class=\"mtk5\">=</span><span class=\"mtk1\">username, </span><span class=\"mtk3\">password</span><span class=\"mtk5\">=</span><span class=\"mtk1\">password)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># if user exists, redirect back to index</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">if</span><span class=\"mtk1\"> user </span><span class=\"mtk5\">is</span><span class=\"mtk1\"> </span><span class=\"mtk5\">not</span><span class=\"mtk1\"> </span><span class=\"mtk5\">None</span><span class=\"mtk1\">:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk7\">login</span><span class=\"mtk1\">()</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">HttpResponseRedirect</span><span class=\"mtk1\">(</span><span class=\"mtk7\">reverse</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;index&quot;</span><span class=\"mtk1\">))</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk4\"># if user does not exist, return login page again</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">else</span><span class=\"mtk1\">:</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">        </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;users/login.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Invalid credentials&quot;</span><span class=\"mtk1\">})</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create logout view function</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">def</span><span class=\"mtk1\"> </span><span class=\"mtk7\">logout_view</span><span class=\"mtk1\">(</span><span class=\"mtk3\">request</span><span class=\"mtk1\">):</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk7\">logout</span><span class=\"mtk1\">(request)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">    </span><span class=\"mtk9\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">render</span><span class=\"mtk1\">(request, </span><span class=\"mtk12\">&quot;users/login.html&quot;</span><span class=\"mtk1\">, {</span><span class=\"mtk12\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Logged out&quot;</span><span class=\"mtk1\">})</span></span></code></pre>\n</li>\n<li>\n<p>create users (using admin interface or shell)</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"python\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk4\">## implement code line-by-line in shell terminal</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk9\">from</span><span class=\"mtk1\"> django.contrib.auth.models </span><span class=\"mtk9\">import</span><span class=\"mtk1\"> User</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># create new user (firstname, email, password)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">user </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> User.objects.</span><span class=\"mtk7\">create_user</span><span class=\"mtk1\">(</span><span class=\"mtk12\">&quot;alice&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">&quot;alice@something.com&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">&quot;alice12345&quot;</span><span class=\"mtk1\">)</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk4\"># can modify user info</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">user.first_name </span><span class=\"mtk5\">=</span><span class=\"mtk1\"> </span><span class=\"mtk12\">&quot;Alice&quot;</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">user.</span><span class=\"mtk7\">save</span><span class=\"mtk1\">()</span></span></code></pre>\n</li>\n</ul>\n<h3>Static Files</h3>\n<p>using external static files (<code>.css</code> or <code>.js</code> files)</p>\n<ul>\n<li>\n<p>need special Django syntax to use external static files</p>\n<pre class=\"andromeda vscode-highlight\" data-language=\"html\"><code class=\"vscode-highlight-code\"><span class=\"vscode-highlight-line\"><span class=\"mtk1\">{% load static %}</span></span>\n<span class=\"vscode-highlight-line\"><span class=\"mtk1\">&lt;</span><span class=\"mtk8\">link</span><span class=\"mtk1\"> </span><span class=\"mtk7\">rel</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;stylesheet&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">href</span><span class=\"mtk1\">=</span><span class=\"mtk12\">&quot;{% static &#39;flights/styles.css&#39; %}&quot;</span><span class=\"mtk1\"> /&gt;</span></span></code></pre>\n</li>\n<li>\n<p><strong>create <code>static</code> folder</strong>:</p>\n<ul>\n<li>create <code>flights</code> <strong>folder where static file will be stored</strong> (define as <strong>namespace folder</strong>)</li>\n</ul>\n</li>\n</ul>\n<style class=\"vscode-highlight-styles\">\n  :root {\n  --vscode-highlight-padding-v: 1rem;\n  --vscode-highlight-padding-h: 1.5rem;\n  --vscode-highlight-padding-top: var(--vscode-highlight-padding-v);\n  --vscode-highlight-padding-right: var(--vscode-highlight-padding-h);\n  --vscode-highlight-padding-bottom: var(--vscode-highlight-padding-v);\n  --vscode-highlight-padding-left: var(--vscode-highlight-padding-h);\n  --vscode-highlight-border-radius: 8px;\n\n  --vscode-highlight-line-highlighted-background-color: transparent;\n  --vscode-highlight-line-highlighted-border-width: 4px;\n  --vscode-highlight-line-highlighted-border-color: transparent;\n}\n\n.vscode-highlight {\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  padding-top: 1rem;\n  padding-top: var(--vscode-highlight-padding-top);\n  padding-bottom: 1rem;\n  padding-bottom: var(--vscode-highlight-padding-bottom);\n  border-radius: 8px;\n  border-radius: var(--vscode-highlight-border-radius);\n  font-feature-settings: normal;\n}\n\n.vscode-highlight-code {\n  display: inline-block;\n  min-width: 100%;\n}\n\n.vscode-highlight-line {\n  display: inline-block;\n  box-sizing: border-box;\n  width: 100%;\n  padding-left: 1.5rem;\n  padding-left: var(--vscode-highlight-padding-left);\n  padding-right: 1.5rem;\n  padding-right: var(--vscode-highlight-padding-right);\n}\n\n.vscode-highlight-line-highlighted {\n  background-color: var(--vscode-highlight-line-highlighted-background-color);\n  box-shadow: inset var(--vscode-highlight-line-highlighted-border-width) 0 0 0 var(--vscode-highlight-line-highlighted-border-color);\n}\n\n  .andromeda {\nbackground-color: #23262E;\ncolor: #D5CED9;\n}\n\n.andromeda .mtk1 { color: #D5CED9; }\n.andromeda .mtk2 { color: #23262E; }\n.andromeda .mtk3 { color: #00E8C6; }\n.andromeda .mtk4 { color: #5F6167; }\n.andromeda .mtk5 { color: #EE5D43; }\n.andromeda .mtk6 { color: #F39C12; }\n.andromeda .mtk7 { color: #FFE66D; }\n.andromeda .mtk8 { color: #F92672; }\n.andromeda .mtk9 { color: #C74DED; }\n.andromeda .mtk10 { color: #7CB7FF; }\n.andromeda .mtk11 { color: #FF00AA; }\n.andromeda .mtk12 { color: #96E072; }\n.andromeda .mtki { font-style: italic; }\n.andromeda .mtkb { font-weight: bold; }\n.andromeda .mtku { text-decoration: underline; text-underline-position: under; }\n</style>","frontmatter":{"title":"Web50 lecture 7 - Django","date":"2019-06-17","tags":["CS50","Web50","Django"]}}},"pageContext":{"slug":"/CS50/web50/lecture_7/"}}}